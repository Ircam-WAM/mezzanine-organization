{% extends "base.html" %}

{% load i18n mezzanine_tags organization_tags %}

{% block meta_title %}{% trans "Search Results" %}{% endblock %}
{% block title %}{% trans "Search Results" %}{% endblock %}
{% block extra_head %}
<meta name="robots" content="noindex">
{% endblock %}

{% block breadcrumb_menu %}
    <li class="breadcrumb__item">
        <a href="{% url "home" %}">{% trans "Home" %}</a>
    </li>
    <li class="breadcrumb__item active">{% trans "Search Results" %}</li>
{% endblock %}

{% block main %}

    <div class="page">
        <div class="container">

            <div class="row">
                <div class="col-sm-9 col-sm-push-3 col-lg-9 col-lg-push-2 white-bg">

                    <form action="{% url "search" %}" role="search" class="search-form">
                        <input class="form-control" placeholder="{% trans "Type something" %}" type="text" name="q" value="{{ request.GET.q }}">
                        <button type="submit">
                            <i class="fa fa-search" aria-hidden="true"></i>
                        </button>
                    </form>

                    <div class="mt2 mb2">
                        <p>
                            {% if results.paginator.count == 0 %}
                            {% blocktrans %}
                            No results were found in {{ search_type }} matching your query: {{ query }}
                            {% endblocktrans %}
                            {% else %}
                            {% blocktrans with start=results.start_index end=results.end_index total=results.paginator.count %}
                            Showing {{ start }} to {{ end }} of {{ total }} results in {{ search_type }} matching your query: {{ query }}
                            {% endblocktrans %}
                            {% endif %}
                        </p>
                    </div>

                </div>
            </div>

            <div class="row">

                <div class="col-sm-3 col-lg-2 page__sidebar">

                    <div style="position: relative;">
                        <ul class="nav-tree nav-tree--level-0" data-sticky data-sticky-parent="row" data-sticky-offset="100" data-sticky-detach-at="971">
                            {% for key,value in filter_dict.items %}
                                <li class="nav-tree__item">
                                    <a class="nav-tree__link nav-tree__link--filter" href="{{ value.url }}">
                                        {{ value.verbose_name }} ({{ value.count }})
                                    </a>
                                </li>
                            {% endfor %}
                            {% if cancel_filter_url %}
                                <li class="nav-tree__item">
                                    <a class="nav-tree__link nav-tree__link--filter active" href="{{ cancel_filter_url }}" title="">Cancel filter</a>
                                </li>
                            {% endif %}
                        </ul>
                    </div>


                </div>

                <div class="mb2 col-sm-9 col-lg-8 white-bg page__content">

                    {% for result in results.object_list %}
                        {# result|classname #}
                        {% if result|classname == 'Event' %}
                            {% with result as event %}
                                {% include 'agenda/includes/event_search.html' %}
                            {% endwith %}
                        {% elif result|classname == 'Playlist' %}
                            {% with result as playlist %}
                                {% include 'media/inc/playlist_search.html' %}
                            {% endwith %}
                        {% else %}
                            {% with result as page %}
                                {% include 'pages/includes/page_search.html' %}
                            {% endwith %}
                        {% endif %}
                    {% endfor %}

                </div>
            </div>

        </div>

        {% pagination_for results %}

    </div>

{% endblock %}
