{% extends "pages/page.html" %}
{% load i18n mezzanine_tags keyword_tags  pages_tags organization_tags %}

{% block meta_title %}{{ page.meta_title }}{% endblock %}

{% block meta_keywords %}{% metablock %}
{% keywords_for page as keywords %}
{% for keyword in keywords %}
    {% if not forloop.first %}, {% endif %}
    {{ keyword }}
{% endfor %}
{% endmetablock %}{% endblock %}

{% block meta_description %}{% metablock %}
{{ page.description }}
{% endmetablock %}{% endblock %}

{% block page_class %}
    department
{% endblock %}

{% block body_class %}
    {% with page.get_ascendants|last as top_level_parent %}
        {% if top_level_parent.get_content_model.weaving_css_class %}
        pattern pattern-bg {{ top_level_parent.get_content_model.weaving_css_class }}
        {% endif %}
    {% endwith %}
{% endblock %}

{% block page_title %}
    {% editable page.projecttopicpage.title %}
        <h1 class="dotted">{{ page.projecttopicpage.title }}</h1>
    {% endeditable %}
{% endblock %}

{% block page_content %}

    {% if page.projecttopicpage.sub_title %}
        {% editable page.projecttopicpage.sub_title %}
            <div class="chapo">
                {{ page.projecttopicpage.sub_title }}
            </div>
        {% endeditable %}
    {% endif %}

    {% with page.projecttopicpage.project_topic as topic %}
        {% for sub_topic in topic|sub_topics %}
            <h2 class="dotted">{{ sub_topic.name }}</h2>
            {% if sub_topic.description %}
                <p>
                    {{ sub_topic.description }}
                </p>
            {% endif %}
            {% if sub_topic.projects.all|get_type:"external project" %}
                <p>
                    <strong>{% trans "European and national projects" %}</strong>
                </p>
                <ul class="unstyled-list">
                    {% for project in sub_topic.projects.all|get_type:"external project" %}
                        <li>
                            <a href="{% url 'organization-project-detail' project.slug %}">{{ project }}</a>
                        </li>
                    {% endfor %}
                </ul>
            {% endif %}
            {% if sub_topic.projects.all|get_type:"internal project" %}
                <p>
                    <strong>{% trans "Internal projects" %}</strong>
                    <ul class="unstyled-list">
                        {% for project in sub_topic.projects.all|get_type:"internal project" %}
                            <li>
                                <a href="{% url 'organization-project-detail' project.slug %}">{{ project }}</a>
                            </li>
                        {% endfor %}
                    </ul>
            {% endif %}
        {% endfor %}
    {% endwith %}

{% endblock %}
