{% extends "pages/page.html" %}
{% load i18n future mezzanine_tags event_tags keyword_tags disqus_tags organization_tags staticfiles %}

{% block meta_title %}
    {% if page %}
        {{ page.richtextpage.meta_title }}
    {% else %}
        {% trans "Events" %}
    {% endif %}
{% endblock %}

{% block meta_keywords %}
    {% metablock %}
        {% keywords_for page as keywords %}
        {% for keyword in keywords %}
            {% if not forloop.first %}, {% endif %}
            {{ keyword }}
        {% endfor %}
    {% endmetablock %}
{% endblock %}

{% block meta_description %}
    {% metablock %}
        {{ page.description }}
    {% endmetablock %}
{% endblock %}

{% block breadcrumb_menu %}
    {{ block.super }}
    {% if tag and tag|tag_is_excluded %}
    <li class="breadcrumb__item">
        <a href="{% url 'event_list' %}" class="breadcrumb__link">{% trans "Tournées" %}</a>
    </li>
    {% elif tag or location or month or week or author %}
        <li class="breadcrumb__item">
            <a href="{% url 'event_list' %}" class="breadcrumb__link">{% trans "Rendez-vous" %}</a>
        </li>
        <li class="breadcrumb__item active">
            {% if tag %}
                {% trans "Tag:" %} {{ tag }}
            {% elif location %}
                {% trans "Location:" %} {{ location }}
            {% elif month %}
                {% if month %}{{ month }}, {% endif %}{{ year }}
            {% elif week %}
                {% for d in week|week_range:year %}
                    {{ d|date:"d M" }}{% if forloop.first %} - {% endif %}
                {% endfor %}
                , {{ year }}
            {% elif author %}
                {% trans "Author:" %} {{ author.get_full_name|default:author.username }}
            {% endif %}
        </li>
    {% else %}
        <li class="breadcrumb__item active">
            {% trans "Rendez-vous" %}
        </li>
    {% endif %}
{% endblock %}

{% block main %}
    <div class="page page--{% spaceless %}{% block page_class %}{% endblock %}{% endspaceless %}">

        <div class="container">

            <div class="row">

                <div class="col-sm-9 col-sm-push-3 col-lg-8 col-lg-push-2 white-bg">

                    <h1 class="dotted">
                        {% if page %}
                            {{ page.richtextpage.meta_title }}
                        {% else %}
                            {% if tag and tag|tag_is_excluded %}
                                {% trans "Tournées" %}
                            {% else %}
                                {% if is_archive %}
                                    {% trans "Archives" %}
                                {% else %}
                                    {% trans "Events" %}
                                {% endif %}
                            {% endif %}
                        {% endif %}
                    </h1>

                </div>

            </div>

            <div class="row">

                <div class="col-sm-3 col-lg-2 page__sidebar">

                    <div style="position: relative;" >
                        {% if tag and not tag|tag_is_excluded or not tag and not is_archive %}
                        <a class="banner banner--light banner--sidebar" href="{% url 'event_list_tag' 'tournees' %}" style="background-image:url({% static 'img/services/tours.jpg' %});">

                            <div class="banner__content">

                                <div class="banner__title fsxxxl">
                                    Tournées {{ CURRENT_SEASON_STYLED }}
                                </div>
                                <div class="banner__desc fss">
                                    Campo Santo, Songes et Métamorphoses, Providences, UM souverain moteur de toutes choses...
                                </div>

                            </div>

                        </a>
                        {% endif %}

                        <ul class="nav-tree nav-tree--level-{{ branch_level }}" data-sticky data-sticky-parent="row" data-sticky-offset="100" data-sticky-detach-at="971">
                            <li class="nav-tree__item">
                                <a class="nav-tree__link active" href="{% url 'event_list' %}">
                                    {% if tag and tag|tag_is_excluded %}
                                        {% trans "Tournées" %}
                                    {% else %}
                                        {% trans "Rendez-vous" %}
                                    {% endif %}
                                </a>

                                <ul class="nav-tree" data-summary>
                                    <li class="nav-tree__item nav-tree__item--sub hide">
                                        <a class="nav-tree__link nav-tree__link--sub" href="#"></a>
                                    </li>
                                </ul>
                            </li>

                            {% if tag and tag|tag_is_excluded %}
                                <li class="nav-tree__item">
                                    <a class="nav-tree__link" href="{% url 'event_list' %}">
                                        {% trans "Rendez-vous" %}
                                    </a>
                                </li>
                            {% else %}
                                <li class="nav-tree__item">
                                    <a class="nav-tree__link" href="{% url 'event_list_tag' 'tournees' %}">
                                        {% trans "Tournées" %}
                                    </a>
                                </li>
                            {% endif %}

                            <li class="nav-tree__separator">

                            </li>

                            {% if tag and not tag|tag_is_excluded or not tag and not is_archive %}

                                {% keywords_for mezzanine_agenda.event as tags %}
                                {# {% all_events as all_events %}#}
                                {% if tags %}
                                    {% comment %}
                                        <a href="{% url 'event_list' %}" class="button{% if not tag %} button--black{% else %} button--white{% endif %}">{% trans "All events" %}</a>
                                    {% endcomment %}
                                    {% for t in tags %}
                                        {% if not t|tag_is_excluded %}
                                            <li class="nav-tree__item">
                                                <a class="nav-tree__link--filter nav-tree__link{% if tag == t %} active{% endif %}" href="{% if tag == t %}{% url 'event_list' %}{% else %}{% url "event_list_tag" t.slug %}{% endif %}">
                                                    {{ t }} {% if tag == t %}<i class="fa fa-times"></i>{% endif %}
                                                </a>
                                            </li>
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}

                            {% endif %}
                        </ul>

                    </div>
                </div>

                <div class="mb2 col-sm-9 col-lg-10 white-bg page__content" data-summary-content>

                    <div class="white-bg page__content">
                        <div class="container">

                            {% for event in events.object_list %}
                                {% include 'agenda/includes/event_linecard.html' %}
                            {% endfor %}

                        </div>
                    </div>

                </div>

            </div>

        </div>
        {% if not is_archive %}
            <div><a href="{% url "event_list_year" CURRENT_SEASON %}" title="{% trans 'archive' %}">{% trans 'archive' %}</div>
        {% endif %}
    </div>
{% endblock %}
